# yaml-language-server: $schema=bundle_config_schema.json
bundle:
  name: techsummit-cvops

workspace:
  host: https://adb-984752964297111.11.azuredatabricks.net/

resources:
  jobs:
    # A four-task Databricks Workflow (all notebooks) - ingestion + preprocessing + training + serve_model
    techsummit_cvops_training:
      name: "[${bundle.environment}] Tech Summit CVOps - Training pipeline"
      job_clusters:
        - job_cluster_key: cpu-cluster
          new_cluster:
            spark_version: 13.3.x-scala2.12
            node_type_id: Standard_DS3_v2
            num_workers: 2
        - job_cluster_key: gpu-cluster
          new_cluster:
            spark_version: 13.3.x-gpu-ml-scala2.12
            node_type_id: Standard_NC6s_v3
            num_workers: 1
      tasks:
        - task_key: "ingestion"
          job_cluster_key: cpu-cluster
          notebook_task:
            base_parameters:
              catalog: "techsummit_cvops_${bundle.environment}"
              schema: "pcb"
            notebook_path: ./etl/ingestion.py
        - task_key: "preprocessing"
          depends_on:
            - task_key: "ingestion"
          job_cluster_key: cpu-cluster
          notebook_task:
            base_parameters:
              catalog: "techsummit_cvops_${bundle.environment}"
              schema: "pcb"
            notebook_path: ./etl/preprocessing.py
        - task_key: "train_model"
          depends_on:
            - task_key: "preprocessing"
          job_cluster_key: gpu-cluster
          notebook_task:
            base_parameters:
              catalog: "techsummit_cvops_${bundle.environment}"
              schema: "pcb"
              experiment_name: "techsummit_cvops_experiment"
              model_name: "techsummit_cvops_model"
            notebook_path: ./train/train_model.py
        - task_key: "serve_model"
          depends_on:
            - task_key: "train_model"
          job_cluster_key: gpu-cluster
          notebook_task:
            base_parameters:
              catalog: "techsummit_cvops_${bundle.environment}"
              schema: "pcb"
              experiment_name: "techsummit_cvops_experiment"
              model_name: "techsummit_cvops_model"
            notebook_path: ./deploy/serve_model.py

environments:
  development:
    default: true

  production:
    host: https://adb-984752964297111.11.azuredatabricks.net/
